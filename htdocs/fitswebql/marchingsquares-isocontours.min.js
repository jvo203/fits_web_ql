/*
 @license GNU Affero General Public License.
 Copyright (c) 2015, 2015 Ronny Lorenz <ronny@tbi.univie.ac.at>
 v. 1.2.0
 https://github.com/RaumZeit/MarchingSquares.js
*/
(function(b,x){"function"===typeof define&&define.amd?define([],function(){return{isoContours:x()}}):"object"===typeof module&&module.exports?module.exports={isoContours:x()}:b.MarchingSquaresJS={isoContours:x(),isoBands:b.MarchingSquaresJS?b.MarchingSquaresJS.isoBands:null}})(this,function(){function b(b,a,u){return(b-a)/(u-a)}function x(b){0!==b.cval&&15!==b.cval&&5!==b.cval&&10!==b.cval&&(b.cval=15)}function A(b,a){if("top"===a)return[b.top,1];if("bottom"===a)return[b.bottom,0];if("right"===a)return[1,
b.right];if("left"===a)return[0,b.left]}function C(b){var a=[],u=0;b.cells.forEach(function(p,r){p.forEach(function(n,m){var c,d;if("undefined"!==typeof n&&5!==n.cval&&10!==n.cval&&0!==n.cval&&15!==n.cval){a:{c=b.cells;var f=c.length;d=[];var g=[0,0,1,1,0,0,0,0,-1,0,1,1,-1,0,-1,0],h=[0,-1,0,0,1,1,1,1,0,-1,0,0,0,-1,0,0],v,l,t="none bottom right right top top top top left bottom right right left bottom left none".split(" "),e,k=c[r][m],q=k.cval;e="none left bottom left right none bottom left top top none top right right bottom none".split(" ")[q];
e=A(k,e);d.push([m+e[0],r+e[1]]);e=t[q];e=A(k,e);d.push([m+e[0],r+e[1]]);x(k);for(var p=m+g[q],y=r+h[q],w=q;0<=p&&0<=y&&y<f&&(p!=m||y!=r);){k=c[y][p];if("undefined"===typeof k)break;q=k.cval;if(0===q||15===q){c=d;d="mergeable";break a}e=t[q];v=g[q];l=h[q];if(5===q||10===q)5===q?k.flipped?(-1===h[w]?(e="left",v=-1):(e="right",v=1),l=0):-1===g[w]&&(e="bottom",v=0,l=-1):10===q&&(k.flipped?-1===g[w]?(e="top",v=0,l=1):(e="bottom",v=0,l=-1):1===h[w]&&(e="left",v=-1,l=0));e=A(k,e);d.push([p+e[0],y+e[1]]);
x(k);p+=v;y+=l;w=q}c=d;d="closed"}f=!1;if("mergeable"===d)for(g=c[c.length-1][0],h=c[c.length-1][1],d=u-1;0<=d;d--)if(1E-7>=Math.abs(a[d][0][0]-g)&&1E-7>=Math.abs(a[d][0][1]-h)){for(f=c.length-2;0<=f;--f)a[d].unshift(c[f]);f=!0;break}f||(a[u++]=c)}})});return a}var B={successCallback:null,verbose:!1},z={};return function(p,a,u){u=u?u:{};for(var w=Object.keys(B),r=0;r<w.length;r++){var n=w[r],m=u[n],m="undefined"!==typeof m&&null!==m?m:B[n];z[n]=m}z.verbose&&console.log("MarchingSquaresJS-isoContours: computing isocontour for "+
a);u=p.length-1;w=p[0].length-1;r={rows:u,cols:w,cells:[]};for(n=0;n<u;++n)for(r.cells[n]=[],m=0;m<w;++m){var c=0,d=p[n+1][m],f=p[n+1][m+1],g=p[n][m+1],h=p[n][m];if(!(isNaN(d)||isNaN(f)||isNaN(g)||isNaN(h))){var c=c|(d>=a?8:0),c=c|(f>=a?4:0),c=c|(g>=a?2:0),c=c|(h>=a?1:0),v=!1;if(5===c||10===c){var l=(d+f+g+h)/4;5===c&&l<a?(c=10,v=!0):10===c&&l<a&&(c=5,v=!0)}if(0!=c&&15!=c){var t,e,k,l=t=e=k=.5;1===c?(e=1-b(a,d,h),t=1-b(a,g,h)):2===c?(t=b(a,h,g),k=1-b(a,f,g)):3===c?(e=1-b(a,d,h),k=1-b(a,f,g)):4===
c?(l=b(a,d,f),k=b(a,g,f)):5===c?(l=b(a,d,f),k=b(a,g,f),t=1-b(a,g,h),e=1-b(a,d,h)):6===c?(t=b(a,h,g),l=b(a,d,f)):7===c?(e=1-b(a,d,h),l=b(a,d,f)):8===c?(e=b(a,h,d),l=1-b(a,f,d)):9===c?(t=1-b(a,g,h),l=1-b(a,f,d)):10===c?(l=1-b(a,f,d),k=1-b(a,f,g),t=b(a,h,g),e=b(a,h,d)):11===c?(l=1-b(a,f,d),k=1-b(a,f,g)):12===c?(e=b(a,h,d),k=b(a,g,f)):13===c?(t=1-b(a,g,h),k=b(a,g,f)):14===c?(e=b(a,h,d),t=b(a,h,g)):console.log("MarchingSquaresJS-isoContours: Illegal cval detected: "+c);r.cells[n][m]={cval:c,flipped:v,
top:l,right:k,bottom:t,left:e}}}}p=C(r);"function"===typeof z.successCallback&&z.successCallback(p);return p}});
